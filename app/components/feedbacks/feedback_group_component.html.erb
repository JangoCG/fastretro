<div
  id="<%= dom_id(@group) %>"
  class="relative mt-3 p-2 border-2 border-dashed border-yellow-500 rounded-lg bg-yellow-50/30 transition-all duration-200"
  data-user-ids="<%= author_user_ids %>"
  <% if @grouping_enabled %>
    data-feedback-id="group-<%= @group.id %>"
    data-feedback-grouping-target="feedback"
  <% end %>
  <% if @voting_enabled %>
    data-vote-sorting-target="item"
  <% end %>
>
  <%# Grouped feedbacks container with dashed border %>
  <div class="relative">
    <%# Background stacked cards effect %>
    <% if other_feedbacks.any? %>
      <div class="absolute -bottom-1 left-1 right-1 h-full bg-zinc-200 border-[2px] border-zinc-900 rounded-sm"></div>
      <% if other_feedbacks.size > 1 %>
        <div class="absolute -bottom-2 left-2 right-2 h-full bg-zinc-300 border-[2px] border-zinc-900 rounded-sm"></div>
      <% end %>
    <% end %>

    <%# Primary card %>
    <div class="relative bg-white border-[2px] border-zinc-900 shadow-[4px_4px_0px_0px_rgba(24,24,27,1)] overflow-hidden">
      <%# Group badge %>
      <div class="absolute top-2 right-2 z-10 flex items-center gap-1 bg-yellow-400 px-2 py-0.5 border border-zinc-900">
        <span class="text-[0.6rem] font-black text-zinc-900 uppercase tracking-wider">
          <%= @feedbacks.size %> grouped
        </span>
      </div>

      <%# Content area %>
      <div class="p-4">
        <%# Technical Header %>
        <div class="flex justify-between items-center border-b-[2px] border-zinc-100 pb-2 mb-3">
          <span class="text-[0.6rem] font-bold text-zinc-400 uppercase tracking-widest font-mono">
            GROUP_<%= @group.id %>
          </span>
        </div>

        <%# Show preview of all feedbacks in group %>
        <div class="space-y-3">
          <% @feedbacks.each_with_index do |feedback, index| %>
            <div class="<%= index > 0 ? 'border-t border-zinc-200 pt-3' : '' %> <%= 'ring-2 ring-sky-400 ring-inset rounded-sm p-1 -m-1' if feedback_highlighted?(feedback) %> <%= 'opacity-30' if feedback_dimmed?(feedback) %> transition-all duration-200">
              <div class="flex justify-between items-start gap-2">
                <div class="flex-1 min-w-0 text-zinc-900 font-bold text-sm leading-snug break-words">
                  <div class="rich-text-content">
                    <%= feedback.content %>
                  </div>
                </div>
                <% if @grouping_enabled %>
                  <%= button_to remove_feedback_retro_feedback_groups_path(feedback.retro, feedback_id: feedback.id),
                      method: :delete,
                      class: "shrink-0 text-[0.5rem] font-bold text-zinc-500 hover:text-zinc-900 uppercase tracking-wider transition-colors px-1.5 py-0.5 border border-zinc-300 hover:border-zinc-500 rounded bg-zinc-50 hover:bg-zinc-100",
                      title: "Remove from group" do %>
                    Ungroup
                  <% end %>
                <% end %>
              </div>
              <div class="flex items-center gap-2 mt-2">
                <div class="w-4 h-4 bg-zinc-900 text-white flex items-center justify-center text-[0.5rem] font-black uppercase">
                  <%= feedback.user.initials %>
                </div>
                <span class="text-[0.55rem] font-bold text-zinc-400 uppercase tracking-wider">
                  <%= feedback.user.name %>
                </span>
              </div>
            </div>
          <% end %>
        </div>
      </div>

      <%# Ungroup button for admins %>
      <% if @grouping_enabled %>
        <div class="px-4 py-2 border-t border-zinc-200 bg-zinc-50">
          <%= button_to retro_feedback_group_path(primary_feedback.retro, @group),
              method: :delete,
              class: "text-[0.6rem] font-bold text-zinc-500 hover:text-zinc-900 uppercase tracking-wider transition-colors" do %>
            Ungroup all
          <% end %>
        </div>
      <% end %>

      <%# Voting controls %>
      <% if show_voting? %>
        <div class="px-4 py-3 border-t border-zinc-200 bg-zinc-50 flex justify-end">
          <%= render VoteButtonComponent.new(voteable: @group, participant: @participant, retro: @retro) %>
        </div>
      <% end %>
    </div>
  </div>
</div>
