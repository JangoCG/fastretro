<% content_for :title, "#{@retro.name} - Waiting Room" %>
<%= turbo_stream_from @retro %>
<%= turbo_refreshes_with method: :morph, scroll: :preserve %>

<div class="max-w-7xl mx-auto px-4 py-12">

  <%# Navigation Header %>
  <div class="flex items-center justify-between mb-12 border-b-2 border-black pb-4">
    <%= render BackButtonComponent.new(label: "RETROS", href: retros_path) %>
    <span class="font-mono text-xs text-zinc-400 uppercase hidden sm:inline-block">/ WAITING_ROOM</span>
  </div>

  <%# Main Grid Layout %>
  <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

    <%# Left Column: Waiting Status %>
    <div class="lg:col-span-7">
      <%# Industrial Header %>
      <div class="border-l-4 border-black pl-6 py-4 mb-8">
        <p class="font-mono text-xs text-zinc-500 mb-2 uppercase tracking-widest">
          RETRO // ID_00<%= @retro.id %>
        </p>
        <h1 class="text-4xl md:text-5xl font-black uppercase tracking-tighter text-black leading-[0.9]">
          "<%= @retro.name %>"
        </h1>
        <p class="font-mono text-xs text-zinc-400 mt-2 uppercase">
          CREATED: <%= @retro.created_at.strftime("%Y.%m.%d // %H:%M:%S") %>
        </p>
      </div>

      <%# Waiting Status Card %>
      <div class="bg-zinc-900 text-white border-[3px] border-black p-8 shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] relative overflow-hidden mb-8">
        <%# Background Grid Overlay %>
        <div class="absolute inset-0 opacity-10 pointer-events-none"
             style="background-image: linear-gradient(0deg, transparent 24%, #ffffff 25%, #ffffff 26%, transparent 27%, transparent 74%, #ffffff 75%, #ffffff 76%, transparent 77%, transparent), linear-gradient(90deg, transparent 24%, #ffffff 25%, #ffffff 26%, transparent 27%, transparent 74%, #ffffff 75%, #ffffff 76%, transparent 77%, transparent); background-size: 30px 30px;">
        </div>

        <div class="relative z-10">
          <div class="flex items-center justify-between border-b border-zinc-700 pb-4 mb-8">
            <div class="flex items-center gap-2">
              <span class="w-3 h-3 bg-amber-400 rounded-[2px] animate-pulse"></span>
              <span class="font-mono text-xs font-bold uppercase tracking-widest text-zinc-400">WAITING FOR TEAM</span>
            </div>
            <span class="font-mono text-[10px] text-zinc-500">SESSION_<%= @retro.id %></span>
          </div>

          <div class="text-center py-6">

            <div class="flex items-center justify-center gap-2 mb-6">
              <span class="w-2 h-2 bg-amber-400 rounded-full animate-bounce" style="animation-delay: 0ms;"></span>
              <span class="w-2 h-2 bg-amber-400 rounded-full animate-bounce" style="animation-delay: 150ms;"></span>
              <span class="w-2 h-2 bg-amber-400 rounded-full animate-bounce" style="animation-delay: 300ms;"></span>
            </div>
            <p class="text-xl font-black uppercase tracking-tight text-white">
              "WAITING FOR EVERYONE TO JOIN"
            </p>
          </div>
        </div>
      </div>

      <%# Participants Grid %>
      <div class="mb-8">
        <div class="flex items-center justify-between mb-4">
          <h2 class="font-black text-lg uppercase tracking-tight text-zinc-900">
            <span class="relative px-1 inline-block">
              <span class="absolute inset-0 bg-[#FFFF00] -rotate-1 skew-x-3 scale-110 -z-10 mix-blend-multiply opacity-80"></span>
              "TEAM MEMBERS"
            </span>
          </h2>
          <span class="font-mono text-xs text-zinc-500 uppercase"><%= @retro.participants.count %> JOINED</span>
        </div>

        <% if @retro.participants.any? %>
          <div id="participants-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
            <% @retro.participants.includes(:user).order(:created_at).each_with_index do |participant, index| %>
              <%= render WaitingParticipantCardComponent.new(participant: participant, index: index) %>
            <% end %>
          </div>
        <% else %>
          <div class="border-2 border-dashed border-zinc-300 p-8 text-center">
            <p class="font-mono text-sm text-zinc-400 uppercase">NO PARTICIPANTS YET</p>
            <p class="font-mono text-xs text-zinc-400 mt-1">SHARE THE INVITE LINK TO ADD TEAM MEMBERS</p>
          </div>
        <% end %>
      </div>

      <%# Start Retro Button %>
      <% if Current.user && @retro.admin?(Current.user) %>
        <%= button_to retro_start_path(@retro), method: :post, class: "group w-full bg-[#ffe600] text-black hover:bg-white font-bold uppercase px-6 py-5 text-base tracking-wider flex items-center justify-between border-[3px] border-black transition-all shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] hover:shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]" do %>
          <span>START RETRO</span>
          <span class="font-mono group-hover:translate-x-2 transition-transform text-lg">-></span>
        <% end %>
      <% else %>
        <div class="w-full bg-zinc-100 text-zinc-500 font-bold uppercase px-6 py-5 text-base tracking-wider flex items-center justify-center border-[3px] border-zinc-300">
          <span>WAITING FOR FACILITATOR TO START</span>
        </div>
      <% end %>
    </div>

    <%# Right Column: Invite Card %>
    <div class="lg:col-span-5">
      <div class="lg:sticky lg:top-8">
        <%= render RetroInviteCardComponent.new(retro: @retro) %>

        <%# Tips Card %>
        <div class="mt-6 border-[3px] border-zinc-900 bg-[#f4f1ea] p-5 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]">
          <h3 class="font-black text-sm uppercase tracking-tight text-zinc-900 mb-3">
            "HOW IT WORKS"
          </h3>
          <ul class="space-y-2 text-xs text-zinc-600 font-mono uppercase">
            <li class="flex items-start gap-2">
              <span class="text-zinc-400">01.</span>
              <span>SHARE THE INVITE LINK WITH YOUR TEAM</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-zinc-400">02.</span>
              <span>WAIT FOR EVERYONE TO JOIN</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-zinc-400">03.</span>
              <span>START THE RETRO WHEN READY</span>
            </li>
          </ul>
        </div>
      </div>
    </div>

  </div>
</div>

