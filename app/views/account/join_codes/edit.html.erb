<% content_for :title, "Edit usage limit" %>

<div class="px-4 py-4">
  <%= render BackButtonComponent.new(label: "Settings", href: account_settings_path, hotkeys: ["left", "esc"], variant: :fizzy) %>
</div>

<div class="max-w-xl mx-auto px-4 py-8 font-sans">
  <div class="bg-[#F8F5EC] border-[3px] border-zinc-900 shadow-[8px_8px_0px_0px_rgba(20,20,23,0.8)] relative" style="view-transition-name: <%= dom_id(@join_code) %>">
    <div class="p-6 border-b-[3px] border-zinc-900 bg-white relative">
      <div class="absolute inset-0 bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:10px_10px]"></div>
      <div class="relative z-10">
        <h1 class="text-2xl font-black text-zinc-900 uppercase tracking-tighter">
          Edit Usage Limit
        </h1>
      </div>
    </div>

    <div class="p-8 relative">
      <div class="absolute inset-0 pointer-events-none bg-[linear-gradient(to_right,#8080800a_1px,transparent_1px),linear-gradient(to_bottom,#8080800a_1px,transparent_1px)] bg-[size:20px_20px]"></div>
      <div class="relative z-10 max-w-md mx-auto w-full space-y-6 text-center">
        <p class="text-sm text-zinc-700">
          Set how many times this invite link can be used.
        </p>

        <%= form_with model: @join_code, url: account_join_code_path, method: :patch, html: { class: "space-y-6 w-full" } do |form| %>
          <div>
            <label for="account_join_code_usage_limit" class="block text-xs font-bold text-zinc-500 uppercase tracking-widest font-mono mb-2">
              Maximum Uses
            </label>
            <div class="flex justify-center">
              <%= form.number_field :usage_limit,
                    required: true,
                    autofocus: true,
                    in: 0..Account::JoinCode::USAGE_LIMIT_MAX,
                    class: "w-full max-w-[12ch] px-4 py-3 bg-white border-[2px] border-zinc-900 text-zinc-900 text-3xl font-black text-center rounded-none focus:outline-none focus:bg-yellow-50 transition-colors" %>
            </div>
          </div>

          <% if @join_code.errors.any? %>
            <div class="p-4 bg-red-50 border-[2px] border-red-500 w-full max-w-sm mx-auto">
              <% @join_code.errors.full_messages.each do |message| %>
                <p class="text-xs font-bold text-red-700"><%= message %></p>
              <% end %>
            </div>
          <% end %>

          <div class="text-sm text-zinc-700">
            Current usage: <strong><%= @join_code.usage_count %> of <%= @join_code.usage_limit_in_database %></strong>
          </div>

          <div class="flex flex-col gap-3 pt-2 sm:flex-row sm:items-center sm:justify-center">
            <%= form.button type: :submit, class: "w-full sm:w-auto inline-flex items-center justify-center px-8 py-3 bg-zinc-900 text-[#F8F5EC] border-[2px] border-zinc-900 font-bold uppercase tracking-widest text-xs hover:-translate-y-0.5 hover:shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] active:translate-y-0 active:shadow-none transition-all" do %>
              Save Changes
            <% end %>

            <%= link_to "Cancel", account_join_code_path, class: "w-full sm:w-auto inline-flex items-center justify-center px-6 py-3 bg-white text-zinc-900 border-[2px] border-zinc-900 font-bold uppercase tracking-widest text-xs hover:bg-zinc-100 transition-colors" %>
          </div>
        <% end %>
      </div>
    </div>

    <div class="h-2 border-t-[3px] border-zinc-900 bg-zinc-900 w-full"></div>
  </div>
</div>
